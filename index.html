<html>
  <head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <style>
      /* --- UI STYLING --- */
      .menu-container {
        position: absolute; 
        top: 20px; left: 20px; z-index: 10;
        background: rgba(0, 204, 102, 0.95); 
        padding: 15px; border-radius: 8px;
        font-family: sans-serif; 
        box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        max-width: 320px;
        color: white; 
      }
      
      .axis-group {
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255,255,255,0.3);
      }
      .axis-group:last-child { border-bottom: none; margin-bottom: 0;}

      .axis-label {
        font-weight: bold; font-size: 14px; 
        margin-bottom: 8px; display: block;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      }

      .control-row {
        display: flex; align-items: center;
        margin-bottom: 6px; justify-content: space-between;
      }
      
      .slice-name {
        font-size: 13px; font-weight: bold; width: 80px; color: #f0f0f0;
      }

      /* Slice Rotation Buttons */
      button.rot-btn { 
        cursor: pointer; padding: 4px 12px; 
        border: 1px solid rgba(0,0,0,0.2); border-radius: 4px; 
        background: #339933; color: white;
        font-size: 16px; width: 45px;
        transition: background 0.2s;
      }
      button.rot-btn:hover { background: #006600; }

      /* Camera Buttons Grid */
      .cam-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 5px;
        margin-bottom: 10px;
      }

      button.cam-btn {
        background: #004d00; 
        border: 1px solid #fff;
        padding: 6px 2px;
        font-size: 12px;
        color: white;
        cursor: pointer;
        border-radius: 4px;
      }
      button.cam-btn:hover { background: #003300; }

      body.animating button { opacity: 0.5; pointer-events: none; }
    </style>
  </head>
  <body>
    
    <div class="menu-container">
        
        <div class="axis-group">
            <span class="axis-label">Camera Views</span>
            <div class="cam-grid">
                <button class="cam-btn" onclick="setView('top')">Top</button>
                <button class="cam-btn" onclick="setView('front')">Front</button>
                <button class="cam-btn" onclick="setView('right')">Right</button>
                <button class="cam-btn" onclick="setView('left')">Left</button>
                <button class="cam-btn" onclick="setView('back')">Back</button>
                <button class="cam-btn" onclick="setView('bottom')">Bottom</button>
            </div>
        </div>

        <div class="axis-group">
            <span class="axis-label">Z-Axis (Front/Back)</span>
            <div class="control-row"><span class="slice-name">Front</span><button class="rot-btn" onclick="rotateSlice('F', 1)">←</button><button class="rot-btn" onclick="rotateSlice('F', -1)">→</button></div>
            <div class="control-row"><span class="slice-name">Stand</span><button class="rot-btn" onclick="rotateSlice('S', 1)">←</button><button class="rot-btn" onclick="rotateSlice('S', -1)">→</button></div>
            <div class="control-row"><span class="slice-name">Back</span><button class="rot-btn" onclick="rotateSlice('B', 1)">←</button><button class="rot-btn" onclick="rotateSlice('B', -1)">→</button></div>
        </div>

        <div class="axis-group">
            <span class="axis-label">Y-Axis (Up/Down)</span>
            <div class="control-row"><span class="slice-name">Up (Top)</span><button class="rot-btn" onclick="rotateSlice('U', -1)">←</button><button class="rot-btn" onclick="rotateSlice('U', 1)">→</button></div>
            <div class="control-row"><span class="slice-name">Equator</span><button class="rot-btn" onclick="rotateSlice('E', -1)">←</button><button class="rot-btn" onclick="rotateSlice('E', 1)">→</button></div>
            <div class="control-row"><span class="slice-name">Down</span><button class="rot-btn" onclick="rotateSlice('D', -1)">←</button><button class="rot-btn" onclick="rotateSlice('D', 1)">→</button></div>
        </div>

        <div class="axis-group">
            <span class="axis-label">X-Axis (Left/Right)</span>
            <div class="control-row"><span class="slice-name">Left</span><button class="rot-btn" onclick="rotateSlice('L', 1)">↓</button><button class="rot-btn" onclick="rotateSlice('L', -1)">↑</button></div>
            <div class="control-row"><span class="slice-name">Middle</span><button class="rot-btn" onclick="rotateSlice('M', 1)">↓</button><button class="rot-btn" onclick="rotateSlice('M', -1)">↑</button></div>
            <div class="control-row"><span class="slice-name">Right</span><button class="rot-btn" onclick="rotateSlice('R', 1)">↓</button><button class="rot-btn" onclick="rotateSlice('R', -1)">↑</button></div>
        </div>
    </div>

    <a-scene>
      <a-assets>
        <a-asset-item id="my-model" src="https://breathofiron.github.io/Textures_for_Graphics_lab/goblin_head_1.glb"></a-asset-item>
        <a-asset-item id="my-name" src="https://breathofiron.github.io/Textures_for_Graphics_lab/Name.glb"></a-asset-item>
        <a-asset-item id="cube-model" src="https://kostasgian21.github.io/computer_graphics/rubiks_cube_standard_solid_v3.glb"></a-asset-item>
        <img id="skyTexture" src="https://breathofiron.github.io/Textures_for_Graphics_lab/chapel.jpg" crossorigin="anonymous"/>
      </a-assets>
      <a-sky src="#skyTexture"></a-sky>
       <a-entity 
        gltf-model="#my-model" 
        position="-2 -1 1.5" 
        scale="15 15 15"
        rotation="-10 30 0">
      </a-entity>
             <a-entity 
        gltf-model="#my-name" 
        position="0 -1 1.5" 
        scale="20 20 20"
        rotation="0 0 0">
      </a-entity>
      <a-entity light="type: ambient; intensity: 0.4; color: #ffffff"></a-entity>
      <a-entity light="type: directional; intensity: 0.5" position="0 2 5"></a-entity>
      <a-entity light="type: directional; intensity: 0.5" position="0 2 -10"></a-entity>
      <a-entity light="type: directional; intensity: 0.5" position="5 2 -3"></a-entity>
      <a-entity light="type: directional; intensity: 0.5" position="-5 2 -3"></a-entity>
      <a-entity light="type: directional; intensity: 0.6" position="0 8 -3"></a-entity>
      <a-entity light="type: directional; intensity: 0.3" position="0 -4 -3"></a-entity>

      <a-entity id="cam-rig" position="0 2 -3" rotation="0 0 0">
         <a-entity camera look-controls position="0 0 9"></a-entity>
      </a-entity>

      <a-entity id="cube-cluster"></a-entity>
      <a-entity id="pivot"></a-entity>
    </a-scene>

    <script>
      /* --- CAMERA LOGIC --- */
      const rig = document.getElementById('cam-rig');
      
      function setView(viewName) {
        let targetRot = "0 0 0";

        switch(viewName) {
            case 'front':  targetRot = "0 0 0"; break;
            case 'back':   targetRot = "0 180 0"; break;
            case 'left':   targetRot = "0 90 0"; break;
            case 'right':  targetRot = "0 -90 0"; break;
            case 'top':    targetRot = "-90 0 0"; break;
            case 'bottom': targetRot = "90 0 0"; break;
        }

        rig.setAttribute('animation', {
            property: 'rotation',
            to: targetRot,
            dur: 800,
            easing: 'easeInOutQuad'
        });
      }

      /* --- CUBE LOGIC --- */
      const cluster = document.getElementById('cube-cluster');
      const pivot = document.getElementById('pivot');
      let isAnimating = false;

      const sliceDefs = {
         F: {center: [0,2,-2], axis: 'z', match: (x,y,z) => z === -2},
         S: {center: [0,2,-3], axis: 'z', match: (x,y,z) => z === -3},
         B: {center: [0,2,-4], axis: 'z', match: (x,y,z) => z === -4},
         U: {center: [0,3,-3], axis: 'y', match: (x,y,z) => y === 3},
         E: {center: [0,2,-3], axis: 'y', match: (x,y,z) => y === 2},
         D: {center: [0,1,-3], axis: 'y', match: (x,y,z) => y === 1},
         L: {center: [-1,2,-3], axis: 'x', match: (x,y,z) => x === -1},
         M: {center: [0,2,-3],  axis: 'x', match: (x,y,z) => x === 0},
         R: {center: [1,2,-3],  axis: 'x', match: (x,y,z) => x === 1},
      };

      const positions = [-1, 0, 1];
      const layersY = [1, 2, 3];
      const layersZ = [-2, -3, -4];

      for (let x of positions) {
        for (let y of layersY) {
            for (let z of layersZ) {
                let el = document.createElement('a-entity');
                el.setAttribute('gltf-model', '#cube-model');
                el.setAttribute('class', 'cubelet');
                el.setAttribute('data-x', x);
                el.setAttribute('data-y', y);
                el.setAttribute('data-z', z);
                el.setAttribute('position', `${x} ${y} ${z}`);
                el.setAttribute('scale', '0.8 0.8 0.8'); 
                cluster.appendChild(el);
            }
        }
      }

      function rotateSlice(face, direction) {
        if (isAnimating) return;
        isAnimating = true;
        document.body.classList.add('animating');

        const def = sliceDefs[face];
        if (!def) return;

        pivot.setAttribute('rotation', '0 0 0'); 
        pivot.setAttribute('position', `${def.center[0]} ${def.center[1]} ${def.center[2]}`);

        const allCubelets = document.querySelectorAll('.cubelet');
        const attachedCubelets = [];

        allCubelets.forEach(el => {
            let x = Math.round(parseFloat(el.getAttribute('data-x')));
            let y = Math.round(parseFloat(el.getAttribute('data-y')));
            let z = Math.round(parseFloat(el.getAttribute('data-z')));

            if (def.match(x, y, z)) {
                pivot.object3D.attach(el.object3D);
                attachedCubelets.push(el);
            }
        });

        let angle = 90 * direction;
        let targetRot = {x: 0, y: 0, z: 0};
        if (def.axis === 'x') targetRot.x = angle;
        if (def.axis === 'y') targetRot.y = angle;
        if (def.axis === 'z') targetRot.z = angle;

        pivot.setAttribute('animation', {
            property: 'rotation',
            to: `${targetRot.x} ${targetRot.y} ${targetRot.z}`,
            dur: 600,
            easing: 'easeInOutQuad'
        });

        pivot.addEventListener('animationcomplete', function onComplete() {
            pivot.removeEventListener('animationcomplete', onComplete);

            attachedCubelets.forEach(el => {
                cluster.object3D.attach(el.object3D);
                el.setAttribute('position', el.object3D.position);
                el.setAttribute('rotation', {
                    x: THREE.MathUtils.radToDeg(el.object3D.rotation.x),
                    y: THREE.MathUtils.radToDeg(el.object3D.rotation.y),
                    z: THREE.MathUtils.radToDeg(el.object3D.rotation.z)
                });
                let newPos = el.object3D.position;
                el.setAttribute('data-x', Math.round(newPos.x));
                el.setAttribute('data-y', Math.round(newPos.y));
                el.setAttribute('data-z', Math.round(newPos.z));
            });

            pivot.removeAttribute('animation');
            pivot.setAttribute('rotation', '0 0 0');
            isAnimating = false;
            document.body.classList.remove('animating');
        });
      }
    </script>
  </body>
</html>
